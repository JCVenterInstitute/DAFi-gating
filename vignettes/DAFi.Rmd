---
title: "Directed Automated Filtering and cluster gating of flow cytometry data"
author: "Ivan Chang"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The `DAFi` package provides a new framework for cell population identification for flow cytometry (`FCM`) data. The framework is compatible with many existing clustering algorithms such as Kmeans, Kmeans++, mini-batch Kmeans, gaussian mixture models, k-medoids, self-organizing map, etc, and allows user to input user defined gating hierarchy to convert the aforementioned unsupervised algorithms into powerful semi-supervised and automatic cell population identification approach. 

- First, the data is read and preprocessed, then configuration files are parsed and implemented as user defined gating directions. 
- Clustering algorithm choosen in the initiation is then applied to the data events of the whole `FCM` data at the start of the iterative gating/filtering loop, and optionally again at each specified population subset (reclustering). 
- At each gating step, the user can specify to apply bisecting (events filtering based on user defined boundaries just like in manual gating), slope-based (events filtering based on user defined slopes), or cluster centroids based filtering (filtering all events members of a cluster based on their centroid's inclusion or exclusion by the user defined gates). 
- Outputs include population events and percentages table, as well as an events printout table consisting of all event's transformed channel values and population membership info for external analysis and plotting. 
- Several built-in plotting options are also available, e.g. 2D dot plots of the user specified gating channels, and centroids overlay to the 2D dot plots.

## The easy way

The easiest way to use this package is using the wrapper function 

```{r}
library(DAFi)

DAFi('sample.fcs', 'inclusion.config', 'exclusion.config', 
		# select method:
		method = "Kmeans",
    # Kmeans options:
    k = 100, initializer = "kmeans++",
    # FlowSOM options:
    xdims = 10, ydims = 10,
		# output options:
		plotCentroids = TRUE,
		writeOutput = TRUE,
		# experimental excluding gated channels in reclustering
		excludeGated = FALSE
		)
```

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
